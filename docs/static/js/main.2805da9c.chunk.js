(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{119:function(e){e.exports={apiKey:"AIzaSyDi8ieOY6yu-LhmL1cG8Xh1m0Vw16VMxpU",authDomain:"local-notes-5eeb6.firebaseapp.com",databaseURL:"https://local-notes-5eeb6.firebaseio.com",projectId:"local-notes-5eeb6",storageBucket:"local-notes-5eeb6.appspot.com",messagingSenderId:"861538591442"}},125:function(e,t,n){e.exports=n(241)},130:function(e,t,n){},134:function(e,t,n){},241:function(e,t,n){"use strict";n.r(t);var a=n(0),r=n.n(a),o=n(29),i=n.n(o),c=(n(130),n(131),n(8)),l=n.n(c),s=n(14),u=n(11),d=n(122),m=n(41),p=(n(134),n(12));function g(e,t,n){var a=e.findIndex(function(e){return e.id===t});return-1===a?e:e.slice(0,a).concat(Object(p.a)({},n,{id:n.id||t})).concat(e.slice(a+1))}function f(e,t){var n=e.findIndex(function(e){return e.id===t});return-1===n?e:e.slice(0,n).concat(e.slice(n+1))}function h(e,t){switch(console.log("reducer action:",t.type,t),t.type){case"startLogin":return null==t.loginEmail?e:Object(p.a)({},e,{data:Object(p.a)({},e.data,{loginEmail:t.loginEmail,loginFlowStage:"started",upSellDisabled:!0}),connectState:"loginStarted"});case"completeLogin":return Object(p.a)({},e,{data:Object(p.a)({},e.data,{loginFlowStage:"completed"}),connectState:"loggedIn"});case"loginFailed":return Object(p.a)({},e,{data:Object(p.a)({},e.data),connectState:"loginFailed"});case"logout":return Object(p.a)({},e,{data:Object(p.a)({},e.data,{loginEmail:void 0,loginFlowStage:void 0}),connectState:void 0});case"setConnectState":return Object(p.a)({},e,{connectState:t.connectState});default:return Object(p.a)({},e,{data:b(e.data,t)})}}function b(e,t){switch(t.type){case"addNote":return Object(p.a)({},e,{notes:(n=e.notes,a=t.content,-1!==n.findIndex(function(e){return e.id===a.id})?n:(console.log("adding note with id: ",a.id),n.concat(Object(p.a)({},a))))});case"modifyNote":return null==t.id?e:Object(p.a)({},e,{notes:g(e.notes,t.id,t.content)});case"removeNote":return null==t.id?e:Object(p.a)({},e,{notes:f(e.notes,t.id)});case"disableUpSell":return Object(p.a)({},e,{upSellDisabled:!0});default:throw new Error("unknown action: "+t.type)}var n,a}var v="appState";function y(){console.log("loading data from local storage");var e,t=localStorage.getItem(v)||"";try{e=JSON.parse(t)}catch(n){e=null}return{data:e||{notes:[]}}}var E=function(){var e,t=(e=y,Object(a.useReducer)(h,null,e)),n=Object(u.a)(t,2),r=n[0],o=n[1];return Object(a.useEffect)(function(){var e;e=r.data,console.log("saving data to local storate"),localStorage.setItem(v,JSON.stringify(e))},[r.data]),[r,o]},w=n(249),x=n(248),O=n(246),j=n(247),k=n(243);var S=function(e){var t=e.show,n=e.initialEmail,o=e.onCancel,i=e.onConfirm,c=Object(a.useState)(n),l=Object(u.a)(c,2),s=l[0],d=l[1];return r.a.createElement(O.a,{show:t,onHide:o},r.a.createElement(j.a,{onSubmit:function(e){e.preventDefault(),s&&i(s)}},r.a.createElement(O.a.Header,{closeButton:!0},r.a.createElement(O.a.Title,null,"Sign up or Login")),r.a.createElement(O.a.Body,null,r.a.createElement("div",{style:{paddingBottom:20}},"Want to share your notes between the devices you use? Enter your email below to sign up or login."),r.a.createElement(j.a.Group,{controlId:"formBasicEmail"},r.a.createElement(j.a.Label,null,"Email address"),r.a.createElement(j.a.Control,{type:"email",placeholder:"Enter email",onChange:function(e){return d(e.target.value)}}),r.a.createElement(j.a.Text,{className:"text-muted"},"We'll never share your email with anyone else."))),r.a.createElement(O.a.Footer,null,r.a.createElement(k.a,{variant:"secondary",onClick:o},"Cancel"),r.a.createElement(k.a,{variant:"primary",type:"submit"},"Login"))))},C=n(27),N=n.n(C);var L=function(e){var t=e.onDismiss,n=e.onAction;return r.a.createElement(N.a,{dismissible:!0,variant:"primary",onClose:t},r.a.createElement(N.a.Heading,null,"Have multiple devices?"),r.a.createElement("p",null,"You can get your notes on every device by\xa0",r.a.createElement("a",{href:"#login",onClick:function(e){e.preventDefault(),n()}},"logging in"),"."))};var F,B,I=function(e){var t=e.status,n=e.onLogin,o=Object(a.useState)(!0),i=Object(u.a)(o,2),c=i[0],l=i[1],s=Object(a.useState)(!0),d=Object(u.a)(s,2),m=d[0],p=d[1];switch(t){case"loginStarted":return r.a.createElement(N.a,{dismissible:!0,variant:"primary",show:c,onClose:function(){return l(!1)}},r.a.createElement(N.a.Heading,null,"Waiting to Login"),r.a.createElement("p",null,"Open the login link in an email we just sent you."));case"loggedIn":return r.a.createElement(N.a,{dismissible:!0,variant:"success",show:c,onClose:function(){return l(!1)}},r.a.createElement(N.a.Heading,null,"Logged in"));case"loginFailed":return r.a.createElement(N.a,{dismissible:!0,variant:"danger",show:m,onClose:function(){return p(!1)}},r.a.createElement(N.a.Heading,null,"Login failed"),r.a.createElement("p",null,"Please\xa0",r.a.createElement("a",{href:"#login",onClick:function(e){e.preventDefault(),n()}},"login"),"\xa0again."));default:return null}},D=n(119),A=n(160);n(208),n(210);var T={url:"".concat("https://leanlauri.github.io/localnotes","/finishLogin/"),handleCodeInApp:!0};function R(e,t){t({type:"setConnectState",connectState:e})}function H(e,t){try{A.apps.length||(console.log("Initialising Firebase"),A.initializeApp(D),(F=A.firestore()).enablePersistence().catch(function(e){console.error("Firestore: Failed to enable offline persistence:",e&&e.code)}))}catch(n){console.error("Firestore: Error initialising:",n&&n.code),R("loginFailed",t)}}function W(){return(W=Object(s.a)(l.a.mark(function e(t,n){return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!B){e.next=2;break}return e.abrupt("return",B);case 2:return e.prev=2,e.next=5,P(t,n);case 5:return e.abrupt("return",e.sent);case 8:return e.prev=8,e.t0=e.catch(2),console.error("Firestore: Error initialising:",e.t0&&e.t0.code),R("loginFailed",n),e.abrupt("return",null);case 13:case"end":return e.stop()}},e,null,[[2,8]])}))).apply(this,arguments)}function P(e,t){return U.apply(this,arguments)}function U(){return(U=Object(s.a)(l.a.mark(function e(t,n){return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise(function(e,t){A.auth().onAuthStateChanged(function(t){console.log("authStateChanged, user:",t),t?(B=t,n({type:"completeLogin"}),e(B)):(B=null,R("loginFailed",n),e(null))})}));case 1:case"end":return e.stop()}},e)}))).apply(this,arguments)}function V(){return(V=Object(s.a)(l.a.mark(function e(t,n,a){return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,console.log("starting login"),H(0,a),e.next=5,A.auth().sendSignInLinkToEmail(t,T);case 5:a({type:"startLogin",loginEmail:t}),e.next=12;break;case 8:e.prev=8,e.t0=e.catch(0),console.error("Firestore: Login failed:",e.t0&&e.t0.code),R("loginFailed",a);case 12:case"end":return e.stop()}},e,null,[[0,8]])}))).apply(this,arguments)}function J(){return(J=Object(s.a)(l.a.mark(function e(t,n,a,r){return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,A.auth().isSignInWithEmailLink(t)){e.next=5;break}return console.error("Address is not a valid login address:",t),r({type:"loginFailed"}),e.abrupt("return");case 5:return e.next=7,A.auth().signInWithEmailLink(n,t);case 7:r({type:"completeLogin"}),e.next=14;break;case 10:e.prev=10,e.t0=e.catch(0),console.error("Error completing login:",e.t0,e.t0&&e.t0.code),r({type:"loginFailed"});case 14:case"end":return e.stop()}},e,null,[[0,10]])}))).apply(this,arguments)}function q(){return(q=Object(s.a)(l.a.mark(function e(t,n){return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,A.auth().signOut();case 2:n({type:"logout"});case 3:case"end":return e.stop()}},e)}))).apply(this,arguments)}function z(){return(z=Object(s.a)(l.a.mark(function e(t,n){return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(F&&B){e.next=3;break}throw console.error("DB or user not initialised"),new Error("DB or user not initialised");case 3:return e.next=5,G(t.data.notes,n);case 5:return e.abrupt("return",Y(t.data.notes,n));case 6:case"end":return e.stop()}},e)}))).apply(this,arguments)}function G(e,t){return M.apply(this,arguments)}function M(){return(M=Object(s.a)(l.a.mark(function e(t,n){return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(B){e.next=2;break}throw new Error("Not logged in");case 2:return e.next=4,F.collection("notes").where("owner","==",B.uid).get();case 4:e.sent.forEach(function(e){var a=e.data();console.log("".concat(e.id," =>"),a),t.find(function(t){return t.id===e.id})?X(e.id,a,n):$(e.id,a,n)});case 6:case"end":return e.stop()}},e)}))).apply(this,arguments)}function Y(e,t){return K.apply(this,arguments)}function K(){return(K=Object(s.a)(l.a.mark(function e(t,n){return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("sending local notes to server"),e.next=3,Promise.all(t.map(function(e){return e.id.startsWith("local:")?Q(e,n):new Promise(function(e,t){return e()})}));case 3:case"end":return e.stop()}},e)}))).apply(this,arguments)}function X(e,t,n){n({type:"modifyNote",source:"remote",id:e,content:{title:t.title,body:t.body}})}function $(e,t,n){n({type:"addNote",source:"remote",content:{id:e,title:t.title,body:t.body}})}function Q(e,t){return Z.apply(this,arguments)}function Z(){return(Z=Object(s.a)(l.a.mark(function e(t,n){var a;return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("storing note to server"),B){e.next=3;break}throw new Error("Not logged in");case 3:return e.prev=3,e.next=6,F.collection("notes").add({title:t.title,body:t.body,owner:B.uid});case 6:a=e.sent,console.log("Document written with ID: ",a.id),n({type:"modifyNote",source:"remote",id:t.id,content:{id:a.id,title:t.title,body:t.body}}),e.next=14;break;case 11:e.prev=11,e.t0=e.catch(3),console.error("Error adding document: ",e.t0);case 14:case"end":return e.stop()}},e,null,[[3,11]])}))).apply(this,arguments)}function _(){return(_=Object(s.a)(l.a.mark(function e(t,n){return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("updating note on server"),B){e.next=3;break}throw new Error("Not logged in");case 3:return e.prev=3,e.next=6,F.collection("notes").doc(t.id).set({title:t.title,body:t.body,owner:B.uid});case 6:console.log("Document ".concat(t.id," updated")),e.next=12;break;case 9:e.prev=9,e.t0=e.catch(3),console.error("Error updating document ".concat(t.id,": "),e.t0);case 12:case"end":return e.stop()}},e,null,[[3,9]])}))).apply(this,arguments)}function ee(){return(ee=Object(s.a)(l.a.mark(function e(t,n){return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("removing note from server"),B){e.next=3;break}throw new Error("Not logged in");case 3:return e.prev=3,e.next=6,F.collection("notes").doc(t).delete();case 6:console.log("Remote document ".concat(t," removed")),e.next=12;break;case 9:e.prev=9,e.t0=e.catch(3),console.error("Error removing document ".concat(t,": "),e.t0);case 12:case"end":return e.stop()}},e,null,[[3,9]])}))).apply(this,arguments)}var te={init:H,waitForUserAuth:function(e,t){return W.apply(this,arguments)},startLogin:function(e,t,n){return V.apply(this,arguments)},finishLogin:function(e,t,n,a){return J.apply(this,arguments)},logout:function(e,t){return q.apply(this,arguments)},sync:function(e,t){return z.apply(this,arguments)},listenToChanges:function(e,t){F&&B?F.collection("notes").where("owner","==",B.uid).onSnapshot({includeMetadataChanges:!0},function(e){e.metadata.fromCache||e.metadata.hasPendingWrites||e.docChanges().forEach(function(e){"added"===e.type?$(e.doc.id,e.doc.data(),t):"modified"===e.type?X(e.doc.id,e.doc.data(),t):"removed"===e.type&&function(e,t){t({type:"removeNote",source:"remote",id:e})}(e.doc.id,t)})}):console.error("DB or user not initialised. Cancelling listen to changes.")},storeNoteRemotely:Q,updateNoteRemotely:function(e,t){return _.apply(this,arguments)},removeNoteRemotely:function(e,t){return ee.apply(this,arguments)}};var ne=function(){var e=Object(a.useContext)(ye),t=Object(u.a)(e,2),n=t[0],o=t[1],i=Object(a.useState)(!1),c=Object(u.a)(i,2),d=c[0],m=c[1],p=function(){var e=Object(s.a)(l.a.mark(function e(t){return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return m(!1),console.log("Login requested with:",t),e.prev=2,e.next=5,te.startLogin(t,n,o);case 5:e.next=11;break;case 7:e.prev=7,e.t0=e.catch(2),console.error("Error sending login email:",e.t0,e.t0&&e.t0.code),o({type:"logout"});case 11:case"end":return e.stop()}},e,null,[[2,7]])}));return function(t){return e.apply(this,arguments)}}();return r.a.createElement(r.a.Fragment,null,r.a.createElement(S,{show:d,initialEmail:n.email,onCancel:function(){return m(!1)},onConfirm:p}),r.a.createElement(w.a,{bg:"light",fixed:"top",expand:!0,onSelect:function(e,t){switch(e){case"#login":m(!0);break;case"#logout":te.logout(n,o)}}},r.a.createElement(w.a.Brand,{href:"#home"},"Local Notes"),r.a.createElement(w.a.Toggle,{"aria-controls":"basic-navbar-nav"}),r.a.createElement(w.a.Collapse,{id:"basic-navbar-nav"},r.a.createElement(x.a,{className:"mr-auto"}),r.a.createElement(x.a,null,"completed"===n.data.loginFlowStage?r.a.createElement(x.a.Link,{href:"#logout"},"Logout"):r.a.createElement(x.a.Link,{href:"#login"},"Login")))),n.data.loginFlowStage||n.data.upSellDisabled?null:r.a.createElement(L,{onDismiss:function(){return o({type:"disableUpSell"})},onAction:function(){return m(!0)}}),r.a.createElement(I,{status:n.connectState,onLogin:function(){return m(!0)}}))},ae=n(244),re=n(245),oe=n(118),ie=n(16),ce=n.n(ie);var le=function(e){var t=e.onClick;return r.a.createElement(ce.a,{style:{width:"100%",height:"20rem",margin:"4px",marginBottom:"8px",borderStyle:"dashed",background:"transparent",borderColor:"white",borderWidth:"medium",color:"white"},onClick:t},r.a.createElement(ce.a.Body,null,r.a.createElement(ce.a.Title,{style:{verticalAlign:"center"}},"Add new note")))},se=n(42),ue=n.n(se),de=n(70),me=n.n(de),pe=n(48),ge=n.n(pe);var fe=function(e){var t=e.show,n=e.title,a=e.message,o=e.onCancel,i=e.onConfirm,c=e.type;return r.a.createElement(ge.a,{show:t,onHide:o},r.a.createElement(ge.a.Header,{closeButton:!0},r.a.createElement(ge.a.Title,null,n)),r.a.createElement(ge.a.Body,null,a),r.a.createElement(ge.a.Footer,null,r.a.createElement(ue.a,{variant:"secondary",onClick:o},"Cancel"),r.a.createElement(ue.a,{variant:"remove"===c?"danger":"primary",onClick:i},"remove"===c?"Remove":"Confirm")))};var he=function(e){var t=e.content,n=e.update,o=e.remove,i=Object(a.useState)(!1),c=Object(u.a)(i,2),l=c[0],s=c[1],d=Object(a.useState)(t.title),m=Object(u.a)(d,2),g=m[0],f=m[1],h=Object(a.useState)(t.body),b=Object(u.a)(h,2),v=b[0],y=b[1],E=Object(a.useState)(!1),w=Object(u.a)(E,2),x=w[0],O=w[1],j=function(e){e.preventDefault(),n(Object(p.a)({},t,{title:g,body:v})),s(!1)};return l?r.a.createElement(r.a.Fragment,null,r.a.createElement(fe,{show:x,title:"Confirm remove",message:"Are you sure you want to remove the note?",onCancel:function(){return O(!1)},onConfirm:o,type:"remove"}),r.a.createElement(me.a,{noValidate:!0,onSubmit:j},r.a.createElement(ce.a,{style:{width:"100%",height:"20rem",margin:"4px",marginBottom:"8px"}},r.a.createElement(ce.a.Body,null,r.a.createElement(ce.a.Title,null,r.a.createElement(me.a.Control,{as:"input",onChange:function(e){return f(e.target.value)},defaultValue:t.title})),r.a.createElement(ce.a.Text,null,r.a.createElement(me.a.Control,{as:"textarea",onChange:function(e){return y(e.target.value)},defaultValue:t.body,style:{height:"11rem",marginBottom:"1rem"}})),r.a.createElement("div",{style:{display:"flex",justifyContent:"space-between"}},r.a.createElement(ue.a,{key:"remove",variant:"outline-danger",onClick:function(){return O(!0)}},"Remove"),r.a.createElement(ue.a,{key:"save",type:"submit"},"Save")))))):r.a.createElement(ce.a,{style:{width:"100%",height:"20rem",margin:"4px",marginBottom:"8px"}},r.a.createElement(ce.a.Body,null,r.a.createElement(ce.a.Title,null,t.title),r.a.createElement("div",{style:{overflow:"auto",height:"12rem",marginBottom:"1rem",whiteSpace:"pre-line"}},r.a.createElement(ce.a.Text,null,t.body)),r.a.createElement(ue.a,{variant:"primary",onClick:function(){s(!0)}},"Edit")))};var be=function(){var e=Object(a.useContext)(ye),t=Object(u.a)(e,2),n=t[0],o=t[1];return r.a.createElement(r.a.Fragment,null,r.a.createElement(ae.a,null,r.a.createElement(re.a,{className:"justify-content-md-center"},n.data.notes.map(function(e){return r.a.createElement(oe.a,{xs:"12",sm:"12",md:"6",lg:"4",xl:"4",key:e.id},r.a.createElement(he,{content:e,update:function(t){return o({type:"modifyNote",id:e.id,content:t})},remove:function(){return o({type:"removeNote",id:e.id})}}))}),r.a.createElement(oe.a,{xs:"12",sm:"12",md:"6",lg:"4",xl:"4",key:"add-button"},r.a.createElement(le,{onClick:function(){return o({type:"addNote",content:{id:"local:"+(new Date).getTime(),title:"New Note",body:""}})}})))))};var ve=function(e,t){return function(n){t(n),"remote"!==n.source&&function(e,t,n){if("loggedIn"===t.connectState)switch(e.type){case"addNote":te.storeNoteRemotely(e.content,n);break;case"modifyNote":te.updateNoteRemotely(e.content,n);break;case"removeNote":te.removeNoteRemotely(e.id,n)}}(n,e,t)}},ye=Object(a.createContext)([null,null]);function Ee(){return(Ee=Object(s.a)(l.a.mark(function e(t,n,a,r){var o;return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("Handling finishLogin request"),te.init(t,n),o=window.location.href,r.push("/"),null!=t.data.loginEmail){e.next=9;break}console.error("No login email in stored state"),n({type:"loginFailed"}),e.next=11;break;case 9:return e.next=11,te.finishLogin(o,t.data.loginEmail,t,n);case 11:case"end":return e.stop()}},e)}))).apply(this,arguments)}var we=function(){var e=E(),t=Object(u.a)(e,2),n=t[0],o=t[1],i=function(e){return"completed"===e.data.loginFlowStage&&"loggedIn"===e.connectState}(n)?ve(n,o):o;return Object(a.useEffect)(function(){"completed"===n.data.loginFlowStage&&Object(s.a)(l.a.mark(function e(){return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,te.init(n,i),e.next=4,te.waitForUserAuth(n,i);case 4:if(!e.sent){e.next=9;break}return e.next=8,te.sync(n,i);case 8:te.listenToChanges(n,i);case 9:e.next=14;break;case 11:e.prev=11,e.t0=e.catch(0),console.error("Error synchronising data:",e.t0);case 14:case"end":return e.stop()}},e,null,[[0,11]])}))()},[n.data.loginEmail,n.data.loginFlowStage]),r.a.createElement("div",{className:"App"},r.a.createElement(d.a,null,r.a.createElement(m.a,{path:"/finishLogin/",render:function(e){var t=e.match,a=e.history;return function(e,t,n,a){Ee.apply(this,arguments)}(n,i,t,a),null}}),r.a.createElement(m.a,{path:"/:section?",render:function(e){var t=e.match;return e.history,console.log("Section",t.params.section),r.a.createElement(ye.Provider,{value:[n,i]},r.a.createElement("div",{className:"topbar-container"},r.a.createElement(ne,null)),r.a.createElement("div",{className:"App-contents"},r.a.createElement(be,null)))}})))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));i.a.render(r.a.createElement(we,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()})}},[[125,1,2]]]);
//# sourceMappingURL=main.2805da9c.chunk.js.map
(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{119:function(e){e.exports={apiKey:"AIzaSyDi8ieOY6yu-LhmL1cG8Xh1m0Vw16VMxpU",authDomain:"local-notes-5eeb6.firebaseapp.com",databaseURL:"https://local-notes-5eeb6.firebaseio.com",projectId:"local-notes-5eeb6",storageBucket:"local-notes-5eeb6.appspot.com",messagingSenderId:"861538591442"}},125:function(e,t,n){e.exports=n(241)},130:function(e,t,n){},134:function(e,t,n){},241:function(e,t,n){"use strict";n.r(t);var a=n(0),o=n.n(a),r=n(29),i=n.n(r),c=(n(130),n(131),n(8)),l=n.n(c),s=n(14),u=n(11),d=n(122),m=n(41),p=(n(134),n(12));function f(e,t,n){var a=e.findIndex(function(e){return e.id===t});return-1===a?e:e.slice(0,a).concat(Object(p.a)({},n,{id:n.id||t})).concat(e.slice(a+1))}function g(e,t){var n=e.findIndex(function(e){return e.id===t});return-1===n?e:e.slice(0,n).concat(e.slice(n+1))}function h(e,t){switch(console.log("reducer action:",t.type,t),t.type){case"startLogin":return null==t.loginEmail?e:Object(p.a)({},e,{data:Object(p.a)({},e.data,{loginEmail:t.loginEmail,loginFlowStage:"started",upSellDisabled:!0}),connectState:"loginStarted"});case"completeLogin":return Object(p.a)({},e,{data:Object(p.a)({},e.data,{loginFlowStage:"completed"}),connectState:"loggedIn"});case"loginFailed":return Object(p.a)({},e,{data:Object(p.a)({},e.data),connectState:"loginFailed"});case"logout":return Object(p.a)({},e,{data:Object(p.a)({},e.data,{loginEmail:void 0,loginFlowStage:void 0}),connectState:void 0});case"setConnectState":return Object(p.a)({},e,{connectState:t.connectState});default:return Object(p.a)({},e,{data:v(e.data,t)})}}function v(e,t){switch(t.type){case"addNote":return Object(p.a)({},e,{notes:(n=e.notes,a=t.content,-1!==n.findIndex(function(e){return e.id===a.id})?n:(console.log("adding note with id: ",a.id),n.concat(Object(p.a)({},a))))});case"modifyNote":return null==t.id?e:Object(p.a)({},e,{notes:f(e.notes,t.id,t.content)});case"removeNote":return null==t.id?e:Object(p.a)({},e,{notes:g(e.notes,t.id)});case"disableUpSell":return Object(p.a)({},e,{upSellDisabled:!0});default:throw new Error("unknown action: "+t.type)}var n,a}var b="appState";function y(){console.log("loading data from local storage");var e,t=localStorage.getItem(b)||"";try{e=JSON.parse(t)}catch(n){e=null}return{data:e||{notes:[]}}}var w=function(){var e,t=(e=y,Object(a.useReducer)(h,null,e)),n=Object(u.a)(t,2),o=n[0],r=n[1];return Object(a.useEffect)(function(){var e;e=o.data,console.log("saving data to local storage"),localStorage.setItem(b,JSON.stringify(e))},[o.data]),[o,r]},E=n(249),x=n(248),k=n(246),j=n(247),O=n(243);var S=function(e){var t=e.show,n=e.initialEmail,r=e.onCancel,i=e.onConfirm,c=Object(a.useState)(n),l=Object(u.a)(c,2),s=l[0],d=l[1];return o.a.createElement(k.a,{show:t,onHide:r},o.a.createElement(j.a,{onSubmit:function(e){e.preventDefault(),s&&i(s)}},o.a.createElement(k.a.Header,{closeButton:!0},o.a.createElement(k.a.Title,null,"Sign up or Login")),o.a.createElement(k.a.Body,null,o.a.createElement("div",{style:{paddingBottom:20}},"Want to share your notes between the devices you use? Enter your email below to sign up or login."),o.a.createElement(j.a.Group,{controlId:"formBasicEmail"},o.a.createElement(j.a.Label,null,"Email address"),o.a.createElement(j.a.Control,{type:"email",placeholder:"Enter email",onChange:function(e){return d(e.target.value)}}),o.a.createElement(j.a.Text,{className:"text-muted"},"We'll never share your email with anyone else."))),o.a.createElement(k.a.Footer,null,o.a.createElement(O.a,{variant:"secondary",onClick:r},"Cancel"),o.a.createElement(O.a,{variant:"primary",type:"submit"},"Login"))))},C=n(27),N=n.n(C);var L=function(e){var t=e.onDismiss,n=e.onAction;return o.a.createElement(N.a,{dismissible:!0,variant:"primary",onClose:t},o.a.createElement(N.a.Heading,null,"Have multiple devices?"),o.a.createElement("p",null,"You can get your notes on every device by\xa0",o.a.createElement("a",{href:"#login",onClick:function(e){e.preventDefault(),n()}},"logging in"),"."))};var F,B,I=function(e){var t=e.status,n=e.onLogin,r=Object(a.useState)(!0),i=Object(u.a)(r,2),c=i[0],l=i[1],s=Object(a.useState)(!0),d=Object(u.a)(s,2),m=d[0],p=d[1];switch(t){case"loginStarted":return o.a.createElement(N.a,{dismissible:!0,variant:"primary",show:c,onClose:function(){return l(!1)}},o.a.createElement(N.a.Heading,null,"Waiting to Login"),o.a.createElement("p",null,"Open the login link in an email we just sent you."));case"loggedIn":return o.a.createElement(N.a,{dismissible:!0,variant:"success",show:c,onClose:function(){return l(!1)}},o.a.createElement(N.a.Heading,null,"Logged in"));case"loginFailed":return o.a.createElement(N.a,{dismissible:!0,variant:"danger",show:m,onClose:function(){return p(!1)}},o.a.createElement(N.a.Heading,null,"Login failed"),o.a.createElement("p",null,"Please\xa0",o.a.createElement("a",{href:"#login",onClick:function(e){e.preventDefault(),n()}},"login"),"\xa0again."));default:return null}},A=n(119),D="/localnotes",T=n(160);n(208),n(210);var W={url:"".concat("https://leanlauri.github.io/localnotes","/finishLogin/"),handleCodeInApp:!0};function R(e,t){t({type:"setConnectState",connectState:e})}function H(e,t){try{T.apps.length||(console.log("Initialising Firebase"),T.initializeApp(A),(F=T.firestore()).enablePersistence().catch(function(e){console.error("Firestore: Failed to enable offline persistence:",e&&e.code)}))}catch(n){console.error("Firestore: Error initialising:",n&&n.code),R("loginFailed",t)}}function P(){return(P=Object(s.a)(l.a.mark(function e(t,n){return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!B){e.next=2;break}return e.abrupt("return",B);case 2:return e.prev=2,e.next=5,U(t,n);case 5:return e.abrupt("return",e.sent);case 8:return e.prev=8,e.t0=e.catch(2),console.error("Firestore: Error initialising:",e.t0&&e.t0.code),R("loginFailed",n),e.abrupt("return",null);case 13:case"end":return e.stop()}},e,null,[[2,8]])}))).apply(this,arguments)}function U(e,t){return V.apply(this,arguments)}function V(){return(V=Object(s.a)(l.a.mark(function e(t,n){return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise(function(e,t){T.auth().onAuthStateChanged(function(t){console.log("authStateChanged, user:",t),t?(B=t,n({type:"completeLogin"}),e(B)):(B=null,R("loginFailed",n),e(null))})}));case 1:case"end":return e.stop()}},e)}))).apply(this,arguments)}function J(){return(J=Object(s.a)(l.a.mark(function e(t,n,a){return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,console.log("starting login"),H(0,a),e.next=5,T.auth().sendSignInLinkToEmail(t,W);case 5:a({type:"startLogin",loginEmail:t}),e.next=12;break;case 8:e.prev=8,e.t0=e.catch(0),console.error("Firestore: Login failed:",e.t0&&e.t0.code),R("loginFailed",a);case 12:case"end":return e.stop()}},e,null,[[0,8]])}))).apply(this,arguments)}function q(){return(q=Object(s.a)(l.a.mark(function e(t,n,a,o){return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,T.auth().isSignInWithEmailLink(t)){e.next=5;break}return console.error("Address is not a valid login address:",t),o({type:"loginFailed"}),e.abrupt("return");case 5:return e.next=7,T.auth().signInWithEmailLink(n,t);case 7:o({type:"completeLogin"}),e.next=14;break;case 10:e.prev=10,e.t0=e.catch(0),console.error("Error completing login:",e.t0,e.t0&&e.t0.code),o({type:"loginFailed"});case 14:case"end":return e.stop()}},e,null,[[0,10]])}))).apply(this,arguments)}function z(){return(z=Object(s.a)(l.a.mark(function e(t,n){return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,T.auth().signOut();case 2:n({type:"logout"});case 3:case"end":return e.stop()}},e)}))).apply(this,arguments)}function G(){return(G=Object(s.a)(l.a.mark(function e(t,n){return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(F&&B){e.next=3;break}throw console.error("DB or user not initialised"),new Error("DB or user not initialised");case 3:return e.next=5,M(t.data.notes,n);case 5:return e.abrupt("return",K(t.data.notes,n));case 6:case"end":return e.stop()}},e)}))).apply(this,arguments)}function M(e,t){return Y.apply(this,arguments)}function Y(){return(Y=Object(s.a)(l.a.mark(function e(t,n){return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(B){e.next=2;break}throw new Error("Not logged in");case 2:return e.next=4,F.collection("notes").where("owner","==",B.uid).get();case 4:e.sent.forEach(function(e){var a=e.data();console.log("".concat(e.id," =>"),a),t.find(function(t){return t.id===e.id})?$(e.id,a,n):Q(e.id,a,n)});case 6:case"end":return e.stop()}},e)}))).apply(this,arguments)}function K(e,t){return X.apply(this,arguments)}function X(){return(X=Object(s.a)(l.a.mark(function e(t,n){return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("sending local notes to server"),e.next=3,Promise.all(t.map(function(e){return e.id.startsWith("local:")?Z(e,n):new Promise(function(e,t){return e()})}));case 3:case"end":return e.stop()}},e)}))).apply(this,arguments)}function $(e,t,n){n({type:"modifyNote",source:"remote",id:e,content:{title:t.title,body:t.body}})}function Q(e,t,n){n({type:"addNote",source:"remote",content:{id:e,title:t.title,body:t.body}})}function Z(e,t){return _.apply(this,arguments)}function _(){return(_=Object(s.a)(l.a.mark(function e(t,n){var a;return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("storing note to server"),B){e.next=3;break}throw new Error("Not logged in");case 3:return e.prev=3,e.next=6,F.collection("notes").add({title:t.title,body:t.body,owner:B.uid});case 6:a=e.sent,console.log("Document written with ID: ",a.id),n({type:"modifyNote",source:"remote",id:t.id,content:{id:a.id,title:t.title,body:t.body}}),e.next=14;break;case 11:e.prev=11,e.t0=e.catch(3),console.error("Error adding document: ",e.t0);case 14:case"end":return e.stop()}},e,null,[[3,11]])}))).apply(this,arguments)}function ee(){return(ee=Object(s.a)(l.a.mark(function e(t,n){return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("updating note on server"),B){e.next=3;break}throw new Error("Not logged in");case 3:return e.prev=3,e.next=6,F.collection("notes").doc(t.id).set({title:t.title,body:t.body,owner:B.uid});case 6:console.log("Document ".concat(t.id," updated")),e.next=12;break;case 9:e.prev=9,e.t0=e.catch(3),console.error("Error updating document ".concat(t.id,": "),e.t0);case 12:case"end":return e.stop()}},e,null,[[3,9]])}))).apply(this,arguments)}function te(){return(te=Object(s.a)(l.a.mark(function e(t,n){return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("removing note from server"),B){e.next=3;break}throw new Error("Not logged in");case 3:return e.prev=3,e.next=6,F.collection("notes").doc(t).delete();case 6:console.log("Remote document ".concat(t," removed")),e.next=12;break;case 9:e.prev=9,e.t0=e.catch(3),console.error("Error removing document ".concat(t,": "),e.t0);case 12:case"end":return e.stop()}},e,null,[[3,9]])}))).apply(this,arguments)}var ne={init:H,waitForUserAuth:function(e,t){return P.apply(this,arguments)},startLogin:function(e,t,n){return J.apply(this,arguments)},finishLogin:function(e,t,n,a){return q.apply(this,arguments)},logout:function(e,t){return z.apply(this,arguments)},sync:function(e,t){return G.apply(this,arguments)},listenToChanges:function(e,t){F&&B?F.collection("notes").where("owner","==",B.uid).onSnapshot({includeMetadataChanges:!0},function(e){e.metadata.fromCache||e.metadata.hasPendingWrites||e.docChanges().forEach(function(e){"added"===e.type?Q(e.doc.id,e.doc.data(),t):"modified"===e.type?$(e.doc.id,e.doc.data(),t):"removed"===e.type&&function(e,t){t({type:"removeNote",source:"remote",id:e})}(e.doc.id,t)})}):console.error("DB or user not initialised. Cancelling listen to changes.")},storeNoteRemotely:Z,updateNoteRemotely:function(e,t){return ee.apply(this,arguments)},removeNoteRemotely:function(e,t){return te.apply(this,arguments)}};var ae=function(){var e=Object(a.useContext)(we),t=Object(u.a)(e,2),n=t[0],r=t[1],i=Object(a.useState)(!1),c=Object(u.a)(i,2),d=c[0],m=c[1],p=function(){var e=Object(s.a)(l.a.mark(function e(t){return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return m(!1),console.log("Login requested with:",t),e.prev=2,e.next=5,ne.startLogin(t,n,r);case 5:e.next=11;break;case 7:e.prev=7,e.t0=e.catch(2),console.error("Error sending login email:",e.t0,e.t0&&e.t0.code),r({type:"logout"});case 11:case"end":return e.stop()}},e,null,[[2,7]])}));return function(t){return e.apply(this,arguments)}}();return o.a.createElement(o.a.Fragment,null,o.a.createElement(S,{show:d,initialEmail:n.email,onCancel:function(){return m(!1)},onConfirm:p}),o.a.createElement(E.a,{bg:"light",fixed:"top",expand:!0,onSelect:function(e,t){switch(e){case"#login":m(!0);break;case"#logout":ne.logout(n,r)}}},o.a.createElement(E.a.Brand,{href:"#home"},"Local Notes"),o.a.createElement(E.a.Toggle,{"aria-controls":"basic-navbar-nav"}),o.a.createElement(E.a.Collapse,{id:"basic-navbar-nav"},o.a.createElement(x.a,{className:"mr-auto"}),o.a.createElement(x.a,null,"completed"===n.data.loginFlowStage?o.a.createElement(x.a.Link,{href:"#logout"},"Logout"):o.a.createElement(x.a.Link,{href:"#login"},"Login")))),n.data.loginFlowStage||n.data.upSellDisabled?null:o.a.createElement(L,{onDismiss:function(){return r({type:"disableUpSell"})},onAction:function(){return m(!0)}}),o.a.createElement(I,{status:n.connectState,onLogin:function(){return m(!0)}}))},oe=n(244),re=n(245),ie=n(118),ce=n(16),le=n.n(ce);var se=function(e){var t=e.onClick;return o.a.createElement(le.a,{style:{width:"100%",height:"20rem",margin:"4px",marginBottom:"8px",borderStyle:"dashed",background:"transparent",borderColor:"white",borderWidth:"medium",color:"white"},onClick:t},o.a.createElement(le.a.Body,null,o.a.createElement(le.a.Title,{style:{verticalAlign:"center"}},"Add new note")))},ue=n(42),de=n.n(ue),me=n(70),pe=n.n(me),fe=n(48),ge=n.n(fe);var he=function(e){var t=e.show,n=e.title,a=e.message,r=e.onCancel,i=e.onConfirm,c=e.type;return o.a.createElement(ge.a,{show:t,onHide:r},o.a.createElement(ge.a.Header,{closeButton:!0},o.a.createElement(ge.a.Title,null,n)),o.a.createElement(ge.a.Body,null,a),o.a.createElement(ge.a.Footer,null,o.a.createElement(de.a,{variant:"secondary",onClick:r},"Cancel"),o.a.createElement(de.a,{variant:"remove"===c?"danger":"primary",onClick:i},"remove"===c?"Remove":"Confirm")))};var ve=function(e){var t=e.content,n=e.update,r=e.remove,i=Object(a.useState)(!1),c=Object(u.a)(i,2),l=c[0],s=c[1],d=Object(a.useState)(t.title),m=Object(u.a)(d,2),f=m[0],g=m[1],h=Object(a.useState)(t.body),v=Object(u.a)(h,2),b=v[0],y=v[1],w=Object(a.useState)(!1),E=Object(u.a)(w,2),x=E[0],k=E[1],j=function(e){e.preventDefault(),n(Object(p.a)({},t,{title:f,body:b})),s(!1)};return l?o.a.createElement(o.a.Fragment,null,o.a.createElement(he,{show:x,title:"Confirm remove",message:"Are you sure you want to remove the note?",onCancel:function(){return k(!1)},onConfirm:r,type:"remove"}),o.a.createElement(pe.a,{noValidate:!0,onSubmit:j},o.a.createElement(le.a,{style:{width:"100%",height:"20rem",margin:"4px",marginBottom:"8px"}},o.a.createElement(le.a.Body,null,o.a.createElement(le.a.Title,null,o.a.createElement(pe.a.Control,{as:"input",onChange:function(e){return g(e.target.value)},defaultValue:t.title})),o.a.createElement(le.a.Text,null,o.a.createElement(pe.a.Control,{as:"textarea",onChange:function(e){return y(e.target.value)},defaultValue:t.body,style:{height:"11rem",marginBottom:"1rem"}})),o.a.createElement("div",{style:{display:"flex",justifyContent:"space-between"}},o.a.createElement(de.a,{key:"remove",variant:"outline-danger",onClick:function(){return k(!0)}},"Remove"),o.a.createElement(de.a,{key:"save",type:"submit"},"Save")))))):o.a.createElement(le.a,{style:{width:"100%",height:"20rem",margin:"4px",marginBottom:"8px"}},o.a.createElement(le.a.Body,null,o.a.createElement(le.a.Title,null,t.title),o.a.createElement("div",{style:{overflow:"auto",height:"12rem",marginBottom:"1rem",whiteSpace:"pre-line"}},o.a.createElement(le.a.Text,null,t.body)),o.a.createElement(de.a,{variant:"primary",onClick:function(){s(!0)}},"Edit")))};var be=function(){var e=Object(a.useContext)(we),t=Object(u.a)(e,2),n=t[0],r=t[1];return o.a.createElement(o.a.Fragment,null,o.a.createElement(oe.a,null,o.a.createElement(re.a,{className:"justify-content-md-center"},n.data.notes.map(function(e){return o.a.createElement(ie.a,{xs:"12",sm:"12",md:"6",lg:"4",xl:"4",key:e.id},o.a.createElement(ve,{content:e,update:function(t){return r({type:"modifyNote",id:e.id,content:t})},remove:function(){return r({type:"removeNote",id:e.id})}}))}),o.a.createElement(ie.a,{xs:"12",sm:"12",md:"6",lg:"4",xl:"4",key:"add-button"},o.a.createElement(se,{onClick:function(){return r({type:"addNote",content:{id:"local:"+(new Date).getTime(),title:"New Note",body:""}})}})))))};var ye=function(e,t){return function(n){t(n),"remote"!==n.source&&function(e,t,n){if("loggedIn"===t.connectState)switch(e.type){case"addNote":ne.storeNoteRemotely(e.content,n);break;case"modifyNote":ne.updateNoteRemotely(e.content,n);break;case"removeNote":ne.removeNoteRemotely(e.id,n)}}(n,e,t)}},we=Object(a.createContext)([null,null]);function Ee(){return(Ee=Object(s.a)(l.a.mark(function e(t,n,a,o){var r;return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("Handling finishLogin request"),ne.init(t,n),r=window.location.href,o.push("/"),null!=t.data.loginEmail){e.next=9;break}console.error("No login email in stored state"),n({type:"loginFailed"}),e.next=11;break;case 9:return e.next=11,ne.finishLogin(r,t.data.loginEmail,t,n);case 11:case"end":return e.stop()}},e)}))).apply(this,arguments)}var xe=function(){var e=w(),t=Object(u.a)(e,2),n=t[0],r=t[1],i=function(e){return"completed"===e.data.loginFlowStage&&"loggedIn"===e.connectState}(n)?ye(n,r):r;return Object(a.useEffect)(function(){"completed"===n.data.loginFlowStage&&Object(s.a)(l.a.mark(function e(){return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,ne.init(n,i),e.next=4,ne.waitForUserAuth(n,i);case 4:if(!e.sent){e.next=9;break}return e.next=8,ne.sync(n,i);case 8:ne.listenToChanges(n,i);case 9:e.next=14;break;case 11:e.prev=11,e.t0=e.catch(0),console.error("Error synchronising data:",e.t0);case 14:case"end":return e.stop()}},e,null,[[0,11]])}))()},[n.data.loginEmail,n.data.loginFlowStage]),o.a.createElement("div",{className:"App"},o.a.createElement(d.a,{basename:D},o.a.createElement(m.a,{path:"/finishLogin/",render:function(e){var t=e.match,a=e.history;return function(e,t,n,a){Ee.apply(this,arguments)}(n,i,t,a),null}}),o.a.createElement(m.a,{path:"/:section?",render:function(e){var t=e.match;return e.history,console.log("Section",t.params.section),o.a.createElement(we.Provider,{value:[n,i]},o.a.createElement("div",{className:"topbar-container"},o.a.createElement(ae,null)),o.a.createElement("div",{className:"App-contents"},o.a.createElement(be,null)))}})))},ke=Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));function je(e,t){navigator.serviceWorker.register(e).then(function(e){e.onupdatefound=function(){var n=e.installing;null!=n&&(n.onstatechange=function(){"installed"===n.state&&(navigator.serviceWorker.controller?(console.log("New content is available and will be used when all tabs for this page are closed. See https://bit.ly/CRA-PWA."),t&&t.onUpdate&&t.onUpdate(e)):(console.log("Content is cached for offline use."),t&&t.onSuccess&&t.onSuccess(e)))})}}).catch(function(e){console.error("Error during service worker registration:",e)})}i.a.render(o.a.createElement(xe,null),document.getElementById("root")),function(e){if("serviceWorker"in navigator){if(new URL("/localnotes",window.location.href).origin!==window.location.origin)return;window.addEventListener("load",function(){var t="".concat("/localnotes","/service-worker.js");ke?(function(e,t){fetch(e).then(function(n){var a=n.headers.get("content-type");404===n.status||null!=a&&-1===a.indexOf("javascript")?navigator.serviceWorker.ready.then(function(e){e.unregister().then(function(){window.location.reload()})}):je(e,t)}).catch(function(){console.log("No internet connection found. App is running in offline mode.")})}(t,e),navigator.serviceWorker.ready.then(function(){console.log("This web app is being served cache-first by a service worker. To learn more, visit https://bit.ly/CRA-PWA")})):je(t,e)})}}()}},[[125,1,2]]]);
//# sourceMappingURL=main.438873e6.chunk.js.map